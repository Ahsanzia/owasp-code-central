using System;
using System.Drawing;
using System.Collections;
using System.ComponentModel;
using System.Windows.Forms;
using System.Configuration;

namespace Owasp.VulnReport
{
	/// <summary>
	/// Summary description for PenTest_Reporter.
	/// </summary>
	public class PenTest_Reporter : System.Windows.Forms.Form
	{

		frmCurrentAndArchivedProjects frmCurrentAndArchivedProjects_MDIChild;
		frmIssueTracking frmIssueTracking_MDIChild;
		frmReports frmReports_MDIChild;
		frmReportXsltEditor frmReportXsltEditor_MDIChild;
		frmRecommendationsDatabase frmRecommendationsDatabase_MDIChild;
		frmOrgPlugIns frmTestPlugIns_MDIChild;
		frmViewFindingsByDate frmViewFindingsByDate_MDIChild;
		frmExport frmExport_MDIChild;

		private System.Windows.Forms.StatusBar statusBar1;
		private System.Windows.Forms.ToolBarButton tbProjects;
		private System.Windows.Forms.ToolBar tbMainToolBar;
		private System.Windows.Forms.ToolBarButton tgIssueTracking;
		private System.Windows.Forms.ToolBarButton tbXsltEditor;
		private System.Windows.Forms.ToolBarButton tbRecommendationsDb;
		private System.Windows.Forms.ToolBarButton tbReports;
		private System.Windows.Forms.MainMenu mainMenu1;
		private System.Windows.Forms.MenuItem menuItem1;
		private System.Windows.Forms.MenuItem miExit;
		private System.Windows.Forms.MenuItem menuItem2;
		private System.Windows.Forms.MenuItem miCurrentAndArchivedProjects;
		private System.Windows.Forms.MenuItem miIssueTracking;
		private System.Windows.Forms.MenuItem miReports;
		private System.Windows.Forms.MenuItem miReportXsltEditor;
		private System.Windows.Forms.MenuItem miRecomendationsDatabase;
		private System.Windows.Forms.MenuItem menuItem3;
		private System.Windows.Forms.MenuItem miCascade;
		private System.Windows.Forms.MenuItem miTileHorizontally;
        private System.Windows.Forms.MenuItem miTileVertically;
		private System.Windows.Forms.MenuItem menuItem6;
		private System.Windows.Forms.MenuItem Plugsins;
        private System.Windows.Forms.MenuItem miViewFindingsByDate;
        private System.Windows.Forms.MenuItem miExport;
        private ToolBarButton tbPlugins;
        private IContainer components;

		public PenTest_Reporter()
		{
			//
			// Required for Windows Form Designer support
			//
			InitializeComponent();
		}

		/// <summary>
		/// Clean up any resources being used.
		/// </summary>
		protected override void Dispose( bool disposing )
		{
			try
			{
				if( disposing )
				{
					if(components != null)
					{
						components.Dispose();
					}
				}
				base.Dispose( disposing );
			}
			catch {}
		}

		#region Windows Form Designer generated code
		/// <summary>
		/// Required method for Designer support - do not modify
		/// the contents of this method with the code editor.
		/// </summary>
		private void InitializeComponent()
		{
            this.components = new System.ComponentModel.Container();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(PenTest_Reporter));
            this.tbMainToolBar = new System.Windows.Forms.ToolBar();
            this.tbProjects = new System.Windows.Forms.ToolBarButton();
            this.tgIssueTracking = new System.Windows.Forms.ToolBarButton();
            this.tbReports = new System.Windows.Forms.ToolBarButton();
            this.tbXsltEditor = new System.Windows.Forms.ToolBarButton();
            this.tbRecommendationsDb = new System.Windows.Forms.ToolBarButton();
            this.tbPlugins = new System.Windows.Forms.ToolBarButton();
            this.statusBar1 = new System.Windows.Forms.StatusBar();
            this.mainMenu1 = new System.Windows.Forms.MainMenu(this.components);
            this.menuItem1 = new System.Windows.Forms.MenuItem();
            this.miExit = new System.Windows.Forms.MenuItem();
            this.menuItem2 = new System.Windows.Forms.MenuItem();
            this.miCurrentAndArchivedProjects = new System.Windows.Forms.MenuItem();
            this.miIssueTracking = new System.Windows.Forms.MenuItem();
            this.miReports = new System.Windows.Forms.MenuItem();
            this.miReportXsltEditor = new System.Windows.Forms.MenuItem();
            this.miRecomendationsDatabase = new System.Windows.Forms.MenuItem();
            this.menuItem6 = new System.Windows.Forms.MenuItem();
            this.miExport = new System.Windows.Forms.MenuItem();
            this.Plugsins = new System.Windows.Forms.MenuItem();
            this.miViewFindingsByDate = new System.Windows.Forms.MenuItem();
            this.menuItem3 = new System.Windows.Forms.MenuItem();
            this.miCascade = new System.Windows.Forms.MenuItem();
            this.miTileHorizontally = new System.Windows.Forms.MenuItem();
            this.miTileVertically = new System.Windows.Forms.MenuItem();
            this.SuspendLayout();
            // 
            // tbMainToolBar
            // 
            this.tbMainToolBar.Buttons.AddRange(new System.Windows.Forms.ToolBarButton[] {
            this.tbProjects,
            this.tgIssueTracking,
            this.tbReports,
            this.tbXsltEditor,
            this.tbRecommendationsDb,
            this.tbPlugins});
            this.tbMainToolBar.ButtonSize = new System.Drawing.Size(200, 22);
            this.tbMainToolBar.DropDownArrows = true;
            this.tbMainToolBar.Location = new System.Drawing.Point(0, 0);
            this.tbMainToolBar.Name = "tbMainToolBar";
            this.tbMainToolBar.ShowToolTips = true;
            this.tbMainToolBar.Size = new System.Drawing.Size(928, 50);
            this.tbMainToolBar.TabIndex = 1;
            this.tbMainToolBar.TextAlign = System.Windows.Forms.ToolBarTextAlign.Right;
            this.tbMainToolBar.ButtonClick += new System.Windows.Forms.ToolBarButtonClickEventHandler(this.tbMainToolBar_ButtonClick);
            // 
            // tbProjects
            // 
            this.tbProjects.Name = "tbProjects";
            this.tbProjects.Text = "Current and Archived Projects";
            // 
            // tgIssueTracking
            // 
            this.tgIssueTracking.Name = "tgIssueTracking";
            this.tgIssueTracking.Text = "Issue Tracking";
            // 
            // tbReports
            // 
            this.tbReports.Name = "tbReports";
            this.tbReports.Text = "Reports";
            // 
            // tbXsltEditor
            // 
            this.tbXsltEditor.Name = "tbXsltEditor";
            this.tbXsltEditor.Text = "Report Xslt Editor";
            // 
            // tbRecommendationsDb
            // 
            this.tbRecommendationsDb.Name = "tbRecommendationsDb";
            this.tbRecommendationsDb.Text = "Recommendations Database";
            // 
            // tbPlugins
            // 
            this.tbPlugins.Name = "tbPlugins";
            this.tbPlugins.Text = "ORG Plug-ins";
            // 
            // statusBar1
            // 
            this.statusBar1.Location = new System.Drawing.Point(0, 448);
            this.statusBar1.Name = "statusBar1";
            this.statusBar1.Size = new System.Drawing.Size(928, 22);
            this.statusBar1.TabIndex = 2;
            // 
            // mainMenu1
            // 
            this.mainMenu1.MenuItems.AddRange(new System.Windows.Forms.MenuItem[] {
            this.menuItem1,
            this.menuItem2,
            this.menuItem6,
            this.menuItem3});
            // 
            // menuItem1
            // 
            this.menuItem1.Index = 0;
            this.menuItem1.MenuItems.AddRange(new System.Windows.Forms.MenuItem[] {
            this.miExit});
            this.menuItem1.Text = "File";
            // 
            // miExit
            // 
            this.miExit.Index = 0;
            this.miExit.Text = "Exit";
            this.miExit.Click += new System.EventHandler(this.miExit_Click);
            // 
            // menuItem2
            // 
            this.menuItem2.Index = 1;
            this.menuItem2.MenuItems.AddRange(new System.Windows.Forms.MenuItem[] {
            this.miCurrentAndArchivedProjects,
            this.miIssueTracking,
            this.miReports,
            this.miReportXsltEditor,
            this.miRecomendationsDatabase});
            this.menuItem2.Text = "PenTest Reporter Functions";
            // 
            // miCurrentAndArchivedProjects
            // 
            this.miCurrentAndArchivedProjects.Index = 0;
            this.miCurrentAndArchivedProjects.Text = "Current and Archived  Projects";
            this.miCurrentAndArchivedProjects.Click += new System.EventHandler(this.miCurrentAndArchivedProjects_Click);
            // 
            // miIssueTracking
            // 
            this.miIssueTracking.Index = 1;
            this.miIssueTracking.Text = "Issue Tracking";
            this.miIssueTracking.Click += new System.EventHandler(this.miIssueTracking_Click);
            // 
            // miReports
            // 
            this.miReports.Index = 2;
            this.miReports.Text = "Reports";
            this.miReports.Click += new System.EventHandler(this.miReports_Click);
            // 
            // miReportXsltEditor
            // 
            this.miReportXsltEditor.Index = 3;
            this.miReportXsltEditor.Text = "Report Xslt Editor";
            this.miReportXsltEditor.Click += new System.EventHandler(this.miReportXsltEditor_Click);
            // 
            // miRecomendationsDatabase
            // 
            this.miRecomendationsDatabase.Index = 4;
            this.miRecomendationsDatabase.Text = "Recomendations Database";
            this.miRecomendationsDatabase.Click += new System.EventHandler(this.miRecomendationsDatabase_Click);
            // 
            // menuItem6
            // 
            this.menuItem6.Index = 2;
            this.menuItem6.MenuItems.AddRange(new System.Windows.Forms.MenuItem[] {
            this.miExport,
            this.Plugsins,
            this.miViewFindingsByDate});
            this.menuItem6.Text = "Beta and Experimental Stuff";
            // 
            // miExport
            // 
            this.miExport.Index = 0;
            this.miExport.Text = "Export";
            this.miExport.Click += new System.EventHandler(this.miExport_Click);
            // 
            // Plugsins
            // 
            this.Plugsins.Index = 1;
            this.Plugsins.Text = "Plug-ins";
            this.Plugsins.Click += new System.EventHandler(this.Plugsins_Click);
            // 
            // miViewFindingsByDate
            // 
            this.miViewFindingsByDate.Index = 2;
            this.miViewFindingsByDate.Text = "View Findings By Date";
            this.miViewFindingsByDate.Click += new System.EventHandler(this.miViewFindingsByDate_Click);
            // 
            // menuItem3
            // 
            this.menuItem3.Index = 3;
            this.menuItem3.MdiList = true;
            this.menuItem3.MenuItems.AddRange(new System.Windows.Forms.MenuItem[] {
            this.miCascade,
            this.miTileHorizontally,
            this.miTileVertically});
            this.menuItem3.Text = "Window";
            // 
            // miCascade
            // 
            this.miCascade.Index = 0;
            this.miCascade.Text = "Cascade";
            this.miCascade.Click += new System.EventHandler(this.miCascade_Click);
            // 
            // miTileHorizontally
            // 
            this.miTileHorizontally.Index = 1;
            this.miTileHorizontally.Text = "Tile Horizontally";
            this.miTileHorizontally.Click += new System.EventHandler(this.menuItem4_Click);
            // 
            // miTileVertically
            // 
            this.miTileVertically.Index = 2;
            this.miTileVertically.Text = "Tile Vertically";
            this.miTileVertically.Click += new System.EventHandler(this.miTileVertically_Click);
            // 
            // PenTest_Reporter
            // 
            this.AutoScaleBaseSize = new System.Drawing.Size(5, 13);
            this.ClientSize = new System.Drawing.Size(928, 470);
            this.Controls.Add(this.statusBar1);
            this.Controls.Add(this.tbMainToolBar);
            this.Icon = ((System.Drawing.Icon)(resources.GetObject("$this.Icon")));
            this.IsMdiContainer = true;
            this.Menu = this.mainMenu1;
            this.Name = "PenTest_Reporter";
            this.Text = "ORG - Owasp Report Generator";
            this.Closed += new System.EventHandler(this.PenTest_Reporter_Closed);
            this.Load += new System.EventHandler(this.PenTest_Reporter_Load);
            this.ResumeLayout(false);
            this.PerformLayout();

		}

		#endregion

		private void PenTest_Reporter_Load(object sender, System.EventArgs e)
		{
			// open this form by default			
            if (false)      // set to false when debugging
			    loadForm_CurrentAndArchivedProjects();
            this.Text += ConfigurationManager.AppSettings["currentVersion"];
		}

		private void loadForm_CurrentAndArchivedProjects()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmCurrentAndArchivedProjects_MDIChild))
			{
				frmCurrentAndArchivedProjects_MDIChild = new frmCurrentAndArchivedProjects();
				frmCurrentAndArchivedProjects_MDIChild.MdiParent = this;				
				frmCurrentAndArchivedProjects_MDIChild.Show();	
			}
		}

		private void loadForm_IssueTracking()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmIssueTracking_MDIChild))
			{
				frmIssueTracking_MDIChild = new frmIssueTracking();
				frmIssueTracking_MDIChild.MdiParent = this;
				frmIssueTracking_MDIChild.Show();	
			}
		}

		private void loadForm_Reports()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmReports_MDIChild))
			{
				frmReports_MDIChild = new frmReports();
				frmReports_MDIChild.MdiParent = this;
				frmReports_MDIChild.Show();	
			}
		}

		private void loadForm_ReportsXsltEditor()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmReportXsltEditor_MDIChild))
			{
				frmReportXsltEditor_MDIChild = new frmReportXsltEditor();
				frmReportXsltEditor_MDIChild.MdiParent = this;
				frmReportXsltEditor_MDIChild.Show();	
			}
		}
		
		private void loadForm_RecommendationsDatabase()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmRecommendationsDatabase_MDIChild))
			{
				frmRecommendationsDatabase_MDIChild = new frmRecommendationsDatabase();
				frmRecommendationsDatabase_MDIChild.MdiParent = this;
				frmRecommendationsDatabase_MDIChild.Show();	
			}
		}

		private void loadForm_PlugIns()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmTestPlugIns_MDIChild))
			{
				frmTestPlugIns_MDIChild = new frmOrgPlugIns();
				frmTestPlugIns_MDIChild.MdiParent = this;
				frmTestPlugIns_MDIChild.Show();	
			}
		}

		private void loadForm_ViewFindingsByDate()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmViewFindingsByDate_MDIChild))
			{
				frmViewFindingsByDate_MDIChild = new frmViewFindingsByDate();
				frmViewFindingsByDate_MDIChild.MdiParent = this;
				frmViewFindingsByDate_MDIChild.Show();	
				frmViewFindingsByDate_MDIChild.ascxViewFindingsBydate1.loadAvailableProjects();
			}
		}

		private void loadForm_Export()
		{
			if (checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(frmExport_MDIChild))
			{
				frmExport_MDIChild = new frmExport();
				frmExport_MDIChild.MdiParent = this;
				frmExport_MDIChild.Show();					
			}
		}

		private void miExit_Click(object sender, System.EventArgs e)
		{
			VulnReportHelpers.deleteTempFilesAndTerminateProcess();
		}

		private void miCurrentAndArchivedProjects_Click(object sender, System.EventArgs e)
		{
			loadForm_CurrentAndArchivedProjects();	
		}
	
		private void miIssueTracking_Click(object sender, System.EventArgs e)
		{
			loadForm_IssueTracking();
		}

		private void miReports_Click(object sender, System.EventArgs e)
		{
			loadForm_Reports();
		}

		private void miReportXsltEditor_Click(object sender, System.EventArgs e)
		{
			loadForm_ReportsXsltEditor();
		}

		private void miRecomendationsDatabase_Click(object sender, System.EventArgs e)
		{
			loadForm_RecommendationsDatabase();
		}

		private void tbMainToolBar_ButtonClick(object sender, System.Windows.Forms.ToolBarButtonClickEventArgs e)
		{
			switch (e.Button.Text)
			{
				case "Current and Archived Projects":
					loadForm_CurrentAndArchivedProjects();
					break;					
				case "Issue Tracking":
					loadForm_IssueTracking();
					break;					
				case "Reports":
					loadForm_Reports();
					break;	
				case "Report Xslt Editor":
					loadForm_ReportsXsltEditor();
					break;									
				case "Recommendations Database":	
					loadForm_RecommendationsDatabase();
					break;
                case "ORG Plug-ins":
                    loadForm_PlugIns();
                    break;
			}
		}		
		private bool checkIfFormIsAlreadyOpenAndIfSoCheckIfTheUserWantsToOpenIt(Control frmMdiChildFormToCheck)
		{						
			
			if (null != frmMdiChildFormToCheck )
			{
				if (false == frmMdiChildFormToCheck.Visible)									
					return true;			
				if (MessageBox.Show("Attention, a form of the type '"+ frmMdiChildFormToCheck.Text + "' is already open, do you want to open another copy?","",MessageBoxButtons.YesNo) == DialogResult.No)
					return false;
			}
			return true;

		}

		private void PenTest_Reporter_Closed(object sender, System.EventArgs e)
		{
			VulnReportHelpers.deleteTempFiles();
		}

		private void miCascade_Click(object sender, System.EventArgs e)
		{
			this.LayoutMdi(MdiLayout.Cascade);
		}

		private void miTileVertically_Click(object sender, System.EventArgs e)
		{
			this.LayoutMdi(MdiLayout.TileVertical);
		}

		private void menuItem4_Click(object sender, System.EventArgs e)
		{
			this.LayoutMdi(MdiLayout.TileHorizontal);
		}

		private void Plugsins_Click(object sender, System.EventArgs e)
		{
			loadForm_PlugIns();
		}

		private void miViewFindingsByDate_Click(object sender, System.EventArgs e)
		{
			loadForm_ViewFindingsByDate();
		}

		private void miExport_Click(object sender, System.EventArgs e)
		{
			loadForm_Export();
		}
        
	}
}
